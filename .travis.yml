jobs:
  include:
    - stage: analyze_data
      dist: xenial
      language: python
      python:
        - 3.7.2
      cache:
        - pip
      install:
        - pip install -r scripts/requirements.txt
      script:
        - python scripts/test-pandas.py

    - stage: build_website
      language: php
      php:
        - 7.3
      script:
        - bin/build-website.sh

    - stage: deploy
      deploy:
        provider: pages
        skip-cleanup: true
        github-token: $GITHUB_TOKEN
        keep-history: true
        verbose: true
        local_dir: site/build_production/
        env:
          - ENV=BUILD
        on:
          branch: master

stages:
  - analyze_data
  - build_website
  - name: deploy
    if: branch = master
